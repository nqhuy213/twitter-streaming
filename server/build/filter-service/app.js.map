{"version":3,"sources":["../../src/filter-service/app.js"],"names":["express","require","registerRoutes","registerMiddlewares","createSocketServer","deregisterAllSockets","registerStreamService","registerDatabase","registerRedis","process","env","NODE_ENV","config","createApp","app","startApp","server","listen","FILTER_PORT","STREAM_SERVICE_URL","console","log"],"mappings":";;AAAA,IAAMA,OAAO,GAAGC,OAAO,CAAC,SAAD,CAAvB;;AACA,IAAMC,cAAc,GAAGD,OAAO,CAAC,yBAAD,CAA9B;;AACA,IAAME,mBAAmB,GAAGF,OAAO,CAAC,mCAAD,CAAnC;;AACA,eAGIA,OAAO,CAAC,6BAAD,CAHX;AAAA,IACEG,kBADF,YACEA,kBADF;AAAA,IAEEC,oBAFF,YAEEA,oBAFF;;AAIA,IAAMC,qBAAqB,GAAGL,OAAO,CAAC,kCAAD,CAArC;;AACA,IAAMM,gBAAgB,GAAGN,OAAO,CAAC,mCAAD,CAAhC;;AACA,IAAMO,aAAa,GAAGP,OAAO,CAAC,uBAAD,CAA7B;;AAEA,IAAIQ,OAAO,CAACC,GAAR,CAAYC,QAAZ,KAAyB,aAA7B,EAA4C;AAC1CV,EAAAA,OAAO,CAAC,QAAD,CAAP,CAAkBW,MAAlB;AACD;;AAED,SAASC,SAAT,GAAqB;AACnB,MAAMC,GAAG,GAAGd,OAAO,EAAnB;AACAG,EAAAA,mBAAmB,CAACW,GAAD,CAAnB;AACAZ,EAAAA,cAAc,CAACY,GAAD,CAAd;AACA,SAAOA,GAAP;AACD;;AAED,SAASC,QAAT,GAAoB;AAClB,MAAMD,GAAG,GAAGD,SAAS,EAArB;AAEA,MAAMG,MAAM,GAAGF,GAAG,CAACG,MAAJ,CAAWR,OAAO,CAACC,GAAR,CAAYQ,WAAvB,EAAoC,YAAM;AACvD;AACAb,IAAAA,oBAAoB;AACpBE,IAAAA,gBAAgB,CAACO,GAAD,EAAM,YAAM;AAC1BN,MAAAA,aAAa,CAACM,GAAD,EAAM,YAAM;AACvBV,QAAAA,kBAAkB,CAACY,MAAD,EAASF,GAAT,CAAlB;AACAR,QAAAA,qBAAqB,CAACG,OAAO,CAACC,GAAR,CAAYS,kBAAb,EAAiCL,GAAjC,CAArB;AACAM,QAAAA,OAAO,CAACC,GAAR,iDAC2CZ,OAAO,CAACC,GAAR,CAAYQ,WADvD;AAGD,OANY,CAAb;AAOD,KARe,CAAhB;AASD,GAZc,CAAf;AAaD;;AAEDH,QAAQ","sourcesContent":["const express = require(\"express\");\r\nconst registerRoutes = require(\"./routes/registerRoutes\");\r\nconst registerMiddlewares = require(\"./middlewares/registerMiddlewares\");\r\nconst {\r\n  createSocketServer,\r\n  deregisterAllSockets,\r\n} = require(\"./socket/createSocketServer\");\r\nconst registerStreamService = require(\"./services/registerStreamService\");\r\nconst registerDatabase = require(\"../libs/database/registerDatabase\");\r\nconst registerRedis = require(\"./redis/registerRedis\");\r\n\r\nif (process.env.NODE_ENV === \"development\") {\r\n  require(\"dotenv\").config();\r\n}\r\n\r\nfunction createApp() {\r\n  const app = express();\r\n  registerMiddlewares(app);\r\n  registerRoutes(app);\r\n  return app;\r\n}\r\n\r\nfunction startApp() {\r\n  const app = createApp();\r\n\r\n  const server = app.listen(process.env.FILTER_PORT, () => {\r\n    //for the sake of testing, deregister all sockets\r\n    deregisterAllSockets();\r\n    registerDatabase(app, () => {\r\n      registerRedis(app, () => {\r\n        createSocketServer(server, app);\r\n        registerStreamService(process.env.STREAM_SERVICE_URL, app);\r\n        console.log(\r\n          `Server is running on http://localhost:${process.env.FILTER_PORT}`\r\n        );\r\n      });\r\n    });\r\n  });\r\n}\r\n\r\nstartApp();\r\n"],"file":"app.js"}